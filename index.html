<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2196F3">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Greek NT">
    <title>Greek NT Learning</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #f5f1e8, #e8dcc0);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ddd;
        }

        .score-display {
            display: flex;
            gap: 10px;
        }

        .score-box {
            padding: 8px 15px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            min-width: 50px;
            text-align: center;
        }

        .correct { background: #4CAF50; }
        .incorrect { background: #f44336; }

        .progress-info {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .mode-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: #2196F3;
            color: white;
            border-color: #2196F3;
        }

        .study-area {
            text-align: center;
            margin: 30px 0;
        }

        .greek-word {
            font-size: 48px;
            font-weight: bold;
            color: #333;
            margin: 20px 0;
            font-family: 'Times New Roman', serif;
        }

        .english-hint {
            font-size: 18px;
            color: #666;
            margin: 10px 0;
            font-style: italic;
        }

        .question-text {
            font-size: 24px;
            margin: 20px 0;
            color: #333;
        }

        .answer-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }

        .answer-btn {
            padding: 15px;
            border: 2px solid #ddd;
            background: #f8f9fa;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .answer-btn:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }

        .answer-btn.correct {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .answer-btn.incorrect {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        .answer-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .answer-btn:disabled:hover {
            background: inherit;
            border-color: inherit;
            transform: none;
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .control-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .primary-btn {
            background: #2196F3;
            color: white;
        }

        .secondary-btn {
            background: #6c757d;
            color: white;
        }

        .success-btn {
            background: #28a745;
            color: white;
        }

        .danger-btn {
            background: #dc3545;
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .vocab-input {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #ddd;
        }

        .input-group {
            margin: 10px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .vocab-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            background: white;
        }

        .vocab-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid #eee;
        }

        .vocab-item:last-child {
            border-bottom: none;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .comprehension-score {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .score-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-size: 24px;
            font-weight: bold;
        }

        .study-recommendations {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .study-recommendations h3 {
            color: #856404;
            margin-bottom: 15px;
        }

        .recommendation-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #f39c12;
        }

        .recommendation-item h4 {
            color: #d68910;
            margin-bottom: 5px;
        }

        .recommendation-item p {
            color: #7d6608;
            margin: 0;
            font-size: 14px;
        }

        .weakness-indicator {
            background: #f8d7da;
            color: #721c24;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .strength-indicator {
            background: #d4edda;
            color: #155724;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .paradigm-selector {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border: 2px solid #e9ecef;
        }

        .paradigm-selector h3 {
            margin: 0 0 10px 0;
            color: #495057;
            font-size: 16px;
        }

        .paradigm-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .paradigm-type-btn {
            padding: 8px 15px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .paradigm-type-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .paradigm-type-btn:hover {
            background: #e9ecef;
        }

        .paradigm-type-btn.active:hover {
            background: #0056b3;
        }

        .performance-dashboard {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid #e1bee7;
        }

        .performance-dashboard h3 {
            color: #4a148c;
            margin-bottom: 15px;
            text-align: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #6a1b9a;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .category-breakdown, .recent-mistakes {
            background: rgba(255,255,255,0.7);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }

        .category-breakdown h4, .recent-mistakes h4 {
            color: #4a148c;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .category-stat {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .category-stat:last-child {
            border-bottom: none;
        }

        .mistake-item {
            background: #ffebee;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 4px solid #f44336;
        }

        .mistake-word {
            font-weight: bold;
            color: #c62828;
        }

        /* Memory Management Styles */
        .memory-management {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid #c8e6c9;
        }

        .memory-management h3 {
            color: #2e7d32;
            margin-bottom: 15px;
            text-align: center;
        }

        .storage-info {
            background: rgba(255,255,255,0.8);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .storage-info h4 {
            color: #1b5e20;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .storage-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .storage-stat {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .storage-stat:last-child {
            border-bottom: none;
        }

        .storage-stat span:first-child {
            color: #666;
            font-weight: 500;
        }

        .storage-stat span:last-child {
            color: #2e7d32;
            font-weight: bold;
        }

        .memory-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 15px;
        }

        .memory-controls .control-btn {
            flex: 1;
            min-width: 120px;
            max-width: 150px;
        }

        .auto-save-status {
            text-align: center;
            padding: 10px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 8px;
            border: 1px solid #c8e6c9;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 5px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4CAF50;
            animation: pulse 2s infinite;
        }

        .status-dot.saving {
            background: #ff9800;
        }

        .status-dot.error {
            background: #f44336;
            animation: none;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        #save-status-text {
            color: #2e7d32;
            font-weight: bold;
            font-size: 14px;
        }

        .auto-save-status small {
            color: #666;
            font-size: 12px;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 15px;
            }
            
            .greek-word {
                font-size: 36px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .control-btn {
                width: 100%;
            }

            .storage-stats {
                grid-template-columns: 1fr;
            }
            
            .memory-controls {
                flex-direction: column;
            }
            
            .memory-controls .control-btn {
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="progress-info">
                <span id="remaining-count">0</span> Remain
            </div>
            <div class="score-display">
                <div class="score-box incorrect" id="incorrect-score">0</div>
                <div class="score-box correct" id="correct-score">0</div>
            </div>
        </div>

        <div class="mode-selector">
            <button class="mode-btn active" onclick="setMode('vocab')">Vocabulary</button>
            <button class="mode-btn" onclick="setMode('paradigm')">Paradigms</button>
            <button class="mode-btn" onclick="setMode('input')">Add Words</button>
        </div>

        <!-- Paradigm Selection -->
        <div id="paradigm-selector" class="paradigm-selector hidden">
            <h3>Choose Paradigm Type:</h3>
            <div class="paradigm-options">
                <button class="paradigm-type-btn active" onclick="setParadigmType('all')">All Mixed</button>
                <button class="paradigm-type-btn" onclick="setParadigmType('articles')">Articles</button>
                <button class="paradigm-type-btn" onclick="setParadigmType('to_be_verbs')">εἰμί (To Be)</button>
                <button class="paradigm-type-btn" onclick="setParadigmType('pronouns')">Pronouns</button>
                <button class="paradigm-type-btn" onclick="setParadigmType('present_active')">Present Active</button>
                <button class="paradigm-type-btn" onclick="setParadigmType('present_mediopassive')">Present M/P</button>
                <button class="paradigm-type-btn" onclick="setParadigmType('deponent_verbs')">Deponent Verbs</button>
            </div>
        </div>

        <!-- Vocabulary Mode -->
        <div id="vocab-mode" class="study-area">
            <div class="greek-word" id="greek-word">λόγος</div>
            <div class="english-hint" id="english-hint" style="display: none;">word, message</div>
            
            <div class="controls">
                <button class="control-btn secondary-btn" onclick="speakGreek()">🔊 Speak</button>
                <button class="control-btn primary-btn" id="reveal-btn" onclick="revealAnswer()">Show Answer</button>
                <button class="control-btn success-btn hidden" id="know-btn" onclick="markCorrect()">✓ Know It</button>
                <button class="control-btn danger-btn hidden" id="dont-know-btn" onclick="markIncorrect()">✗ Don't Know</button>
                <button class="control-btn primary-btn hidden" id="next-btn" onclick="nextWord()">Next →</button>
            </div>
        </div>

        <!-- Paradigm Mode -->
        <div id="paradigm-mode" class="study-area hidden">
            <div class="greek-word" id="paradigm-word">ἐσμέν</div>
            <div class="english-hint" id="paradigm-hint" style="display: none;">we are</div>
            <div class="question-text" id="paradigm-question">Identify Case</div>
            
            <div class="answer-options" id="paradigm-answers">
                <button class="answer-btn" onclick="selectAnswer('nominative')">nominative</button>
                <button class="answer-btn" onclick="selectAnswer('genitive')">genitive</button>
                <button class="answer-btn" onclick="selectAnswer('dative')">dative</button>
                <button class="answer-btn" onclick="selectAnswer('accusative')">accusative</button>
                <button class="answer-btn" onclick="selectAnswer('vocative')">vocative</button>
            </div>
            
            <div class="controls">
                <button class="control-btn secondary-btn" onclick="speakGreek()">🔊 Speak</button>
                <button class="control-btn primary-btn" onclick="nextParadigm()">Next →</button>
            </div>
        </div>

        <!-- Input Mode -->
        <div id="input-mode" class="hidden">
            <div class="vocab-input">
                <div class="input-group">
                    <label>Greek Word:</label>
                    <input type="text" id="greek-input" placeholder="Enter Greek word" oninput="smartDetectWordType()">
                </div>
                <div class="input-group">
                    <label>English Translation:</label>
                    <input type="text" id="english-input" placeholder="Enter English translation">
                </div>
                <div class="input-group">
                    <label>Type: <span id="auto-detected" style="color: #28a745; font-size: 12px;"></span></label>
                    <select id="type-input">
                        <option>noun</option>
                        <option>verb</option>
                        <option>adjective</option>
                        <option>pronoun</option>
                        <option>article</option>
                        <option>preposition</option>
                        <option>conjunction</option>
                        <option>adverb</option>
                        <option>deponent_verb</option>
                        <option>proper_noun</option>
                        <option>interjection</option>
                        <option>negator</option>
                        <option>number</option>
                    </select>
                </div>
                <div class="input-group" id="declension-group">
                    <label>Declension (for nouns): <span id="auto-detected-decl" style="color: #28a745; font-size: 12px;"></span></label>
                    <select id="declension-input">
                        <option value="">Auto-detect</option>
                        <option value="1st">1st Declension</option>
                        <option value="2nd">2nd Declension</option>
                        <option value="3rd">3rd Declension</option>
                    </select>
                </div>
                <button class="control-btn primary-btn" onclick="addVocab()">Add Word</button>
                <button class="control-btn secondary-btn" onclick="importVocab()">Import CSV</button>
                <button class="control-btn primary-btn" onclick="uploadLessonDocument()">📄 Upload Lesson Document</button>
            </div>
            
            <div class="vocab-list" id="vocab-list">
                <!-- Vocabulary items will be displayed here -->
            </div>
        </div>

        <!-- Comprehension Score -->
        <div class="comprehension-score">
            <div class="score-circle" id="comprehension-percentage">0%</div>
            <div>Comprehension Score</div>
            <div style="font-size: 14px; opacity: 0.8; margin-top: 5px;">
                Based on your recent performance
            </div>
        </div>

        <!-- Study Recommendations -->
        <div id="study-recommendations" class="study-recommendations hidden">
            <h3>📚 Areas to Focus On:</h3>
            <div id="recommendations-list"></div>
            <button class="control-btn primary-btn" onclick="hideRecommendations()">Continue Studying</button>
        </div>

        <!-- Performance Dashboard -->
        <div class="performance-dashboard">
            <h3>📊 Performance Summary</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-attempted">0</div>
                    <div class="stat-label">Total Attempted</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="accuracy-rate">0%</div>
                    <div class="stat-label">Overall Accuracy</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="words-due">0</div>
                    <div class="stat-label">Due for Review</div>
                </div>
            </div>
            
            <div class="category-breakdown">
                <h4>Category Performance:</h4>
                <div id="category-stats"></div>
            </div>
            
            <div class="recent-mistakes">
                <h4>Recent Problem Areas:</h4>
                <div id="mistake-list"></div>
            </div>
        </div>

        <!-- Memory Management Section -->
        <div class="memory-management">
            <h3>💾 Progress Management</h3>
            
            <div class="storage-info">
                <h4>Storage Status:</h4>
                <div class="storage-stats" id="storage-stats">
                    <div class="storage-stat">
                        <span>Vocabulary Words:</span>
                        <span id="vocab-count">0</span>
                    </div>
                    <div class="storage-stat">
                        <span>Paradigms:</span>
                        <span id="paradigm-count">0</span>
                    </div>
                    <div class="storage-stat">
                        <span>Total Questions:</span>
                        <span id="total-questions">0</span>
                    </div>
                    <div class="storage-stat">
                        <span>Last Saved:</span>
                        <span id="last-saved">Never</span>
                    </div>
                    <div class="storage-stat">
                        <span>Data Size:</span>
                        <span id="data-size">0 KB</span>
                    </div>
                </div>
            </div>
            
            <div class="memory-controls">
                <button class="control-btn primary-btn" onclick="saveDataManually()">💾 Save Now</button>
                <button class="control-btn secondary-btn" onclick="exportProgress()">📤 Export</button>
                <button class="control-btn secondary-btn" onclick="importProgress()">📥 Import</button>
                <button class="control-btn primary-btn" onclick="refreshStorageInfo()">🔄 Refresh</button>
                <button class="control-btn danger-btn" onclick="clearAllData()">🗑️ Clear All</button>
            </div>
            
            <div class="auto-save-status">
                <div class="status-indicator" id="save-status">
                    <span class="status-dot"></span>
                    <span id="save-status-text">Auto-save enabled</span>
                </div>
                <small>Your progress is automatically saved every 30 seconds and when you switch tabs.</small>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let vocabulary = [
            {id: 1, greek: "ὁ ἄνθρωπος", english: "human being", type: "noun", declension: "2nd", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 2, greek: "ὁ ἄρτος", english: "loaf", type: "noun", declension: "2nd", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 3, greek: "ἡ ἀδελφή", english: "sister", type: "noun", declension: "1st", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 4, greek: "τὸ τέκνον", english: "child", type: "noun", declension: "2nd", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 5, greek: "τὸ πετεινόν", english: "bird", type: "noun", declension: "2nd", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 6, greek: "κράζω", english: "to shout", type: "verb", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 7, greek: "ὁ ὀφθαλμός", english: "eye", type: "noun", declension: "2nd", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 8, greek: "ἡ κεφαλή", english: "head", type: "noun", declension: "1st", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 9, greek: "ἡ ποίμνη", english: "flock", type: "noun", declension: "1st", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 10, greek: "τὸ ποτήριον", english: "cup", type: "noun", declension: "2nd", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 11, greek: "ὁ ἵππος", english: "horse", type: "noun", declension: "2nd", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 12, greek: "ὁ θεός", english: "God", type: "noun", declension: "2nd", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 13, greek: "τύπτω", english: "to hit", type: "verb", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 14, greek: "ὁ καρπός", english: "fruit", type: "noun", declension: "2nd", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 15, greek: "ἡ σκηνή", english: "tent", type: "noun", declension: "1st", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 16, greek: "ἡ ἐπιστολή", english: "letter", type: "noun", declension: "1st", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 17, greek: "τὸ ἱμάτιον", english: "clothing", type: "noun", declension: "2nd", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 18, greek: "ὁ νόμος", english: "law", type: "noun", declension: "2nd", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 19, greek: "τὸ βιβλίον", english: "book", type: "noun", declension: "2nd", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 20, greek: "νεύω", english: "to nod", type: "verb", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 21, greek: "βλέπω", english: "to see", type: "verb", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 22, greek: "ἐσθίω", english: "to eat", type: "verb", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 23, greek: "ἡ κώμη", english: "village", type: "noun", declension: "1st", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 24, greek: "ὁ ἀπόστολος", english: "ambassador", type: "noun", declension: "2nd", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 25, greek: "ἔρχομαι", english: "to come", type: "deponent_verb", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 26, greek: "πορεύομαι", english: "to go", type: "deponent_verb", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 27, greek: "εἰμί", english: "to be", type: "verb", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 28, greek: "Ἰησοῦς", english: "Jesus", type: "proper_noun", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 29, greek: "πρός", english: "to, towards", type: "preposition", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 30, greek: "ἐν", english: "in", type: "preposition", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5}
        ];

        let paradigms = [
            {id: 1, greek: "λύω", english: "I am loosing", person: "1st", number: "singular", type: "present_active", category: "present_active", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 2, greek: "λύεις", english: "you are loosing", person: "2nd", number: "singular", type: "present_active", category: "present_active", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 3, greek: "λύει", english: "he/she/it is loosing", person: "3rd", number: "singular", type: "present_active", category: "present_active", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 4, greek: "λύομεν", english: "we are loosing", person: "1st", number: "plural", type: "present_active", category: "present_active", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 5, greek: "λύετε", english: "you are loosing", person: "2nd", number: "plural", type: "present_active", category: "present_active", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 6, greek: "λύουσι(ν)", english: "they are loosing", person: "3rd", number: "plural", type: "present_active", category: "present_active", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 7, greek: "λύομαι", english: "I am being loosed", person: "1st", number: "singular", type: "present_mediopassive", category: "present_mediopassive", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 8, greek: "λύῃ", english: "you are being loosed", person: "2nd", number: "singular", type: "present_mediopassive", category: "present_mediopassive", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 9, greek: "λύεται", english: "he/she/it is being loosed", person: "3rd", number: "singular", type: "present_mediopassive", category: "present_mediopassive", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 10, greek: "ὁ", english: "the", case: "nominative", gender: "masculine", type: "article", category: "articles", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 11, greek: "τοῦ", english: "the", case: "genitive", gender: "masculine", type: "article", category: "articles", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 12, greek: "τῷ", english: "the", case: "dative", gender: "masculine", type: "article", category: "articles", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 13, greek: "τόν", english: "the", case: "accusative", gender: "masculine", type: "article", category: "articles", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 14, greek: "εἰμί", english: "I am", person: "1st", number: "singular", type: "verb", category: "to_be_verbs", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 15, greek: "εἶ", english: "you are", person: "2nd", number: "singular", type: "verb", category: "to_be_verbs", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5},
            {id: 16, greek: "ἐστί(ν)", english: "he/she/it is", person: "3rd", number: "singular", type: "verb", category: "to_be_verbs", correct: 0, attempts: 0, lastReviewed: 0, interval: 1, easeFactor: 2.5}
        ];

        let currentMode = 'vocab';
        let currentWordIndex = 0;
        let currentParadigmIndex = 0;
        let selectedParadigmType = 'all';
        let sessionStats = {correct: 0, incorrect: 0, total: 0};
        let categoryStats = {
            articles: {correct: 0, total: 0},
            to_be_verbs: {correct: 0, total: 0},
            pronouns: {correct: 0, total: 0},
            present_active: {correct: 0, total: 0},
            present_mediopassive: {correct: 0, total: 0},
            deponent_verbs: {correct: 0, total: 0},
            other_paradigms: {correct: 0, total: 0},
            vocabulary: {correct: 0, total: 0}
        };

        let appState = {
            currentMode: 'vocab',
            selectedParadigmType: 'all',
            lastWordIndex: 0,
            lastParadigmIndex: 0,
            studyStartTime: Date.now(),
            dailyGoal: 50,
            dailyProgress: 0
        };

        // All JavaScript functions
        function saveData() {
            try {
                localStorage.setItem('greekVocabulary', JSON.stringify(vocabulary));
                localStorage.setItem('greekParadigms', JSON.stringify(paradigms));
                localStorage.setItem('greekStats', JSON.stringify(sessionStats));
                localStorage.setItem('greekCategoryStats', JSON.stringify(categoryStats));
                
                appState.currentMode = currentMode;
                appState.selectedParadigmType = selectedParadigmType;
                appState.lastWordIndex = currentWordIndex;
                appState.lastParadigmIndex = currentParadigmIndex;
                localStorage.setItem('greekAppState', JSON.stringify(appState));
                localStorage.setItem('greekLastSaved', Date.now().toString());
                
                console.log('✅ Data saved successfully');
                updateSaveStatus('success', 'Saved!');
            } catch (error) {
                console.error('❌ Error saving data:', error);
                updateSaveStatus('error', 'Save failed');
                showNotification('Error saving progress. Please check your browser storage.', 'error');
            }
        }

        function loadData() {
            try {
                const savedVocab = localStorage.getItem('greekVocabulary');
                if (savedVocab) {
                    const loadedVocab = JSON.parse(savedVocab);
                    vocabulary = mergeVocabulary(loadedVocab, vocabulary);
                }
                
                const savedParadigms = localStorage.getItem('greekParadigms');
                if (savedParadigms) {
                    const loadedParadigms = JSON.parse(savedParadigms);
                    paradigms = mergeParadigms(loadedParadigms, paradigms);
                }
                
                const savedStats = localStorage.getItem('greekStats');
                if (savedStats) {
                    sessionStats = JSON.parse(savedStats);
                }
                
                const savedCategoryStats = localStorage.getItem('greekCategoryStats');
                if (savedCategoryStats) {
                    categoryStats = JSON.parse(savedCategoryStats);
                }
                
                const savedAppState = localStorage.getItem('greekAppState');
                if (savedAppState) {
                    appState = {...appState, ...JSON.parse(savedAppState)};
                    currentMode = appState.currentMode;
                    selectedParadigmType = appState.selectedParadigmType;
                    currentWordIndex = Math.min(appState.lastWordIndex, vocabulary.length - 1);
                    currentParadigmIndex = Math.min(appState.lastParadigmIndex, paradigms.length - 1);
                }
                
                showNotification('Progress restored successfully!', 'success');
            } catch (error) {
                console.error('❌ Error loading data:', error);
                showNotification('Error loading saved progress. Using defaults.', 'warning');
            }
        }

        function mergeVocabulary(saved, defaults) {
            const merged = [...defaults];
            saved.forEach(savedWord => {
                const existingIndex = merged.findIndex(w => w.id === savedWord.id);
                if (existingIndex >= 0) {
                    merged[existingIndex] = {...merged[existingIndex], ...savedWord};
                } else {
                    merged.push(savedWord);
                }
            });
            return merged;
        }

        function mergeParadigms(saved, defaults) {
            const merged = [...defaults];
            saved.forEach(savedParadigm => {
                const existingIndex = merged.findIndex(p => p.id === savedParadigm.id);
                if (existingIndex >= 0) {
                    merged[existingIndex] = {...merged[existingIndex], ...savedParadigm};
                } else {
                    merged.push(savedParadigm);
                }
            });
            return merged;
        }

        function startAutoSave() {
            setInterval(() => {
                if (document.hasFocus()) {
                    saveData();
                }
            }, 30000);
            
            window.addEventListener('beforeunload', () => {
                saveData();
            });
            
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    saveData();
                }
            });
        }

        function validateAndRepairData() {
            let repaired = false;
            
            vocabulary.forEach(word => {
                if (typeof word.lastReviewed === 'undefined') {
                    word.lastReviewed = 0;
                    repaired = true;
                }
                if (typeof word.interval === 'undefined') {
                    word.interval = 1;
                    repaired = true;
                }
                if (typeof word.easeFactor === 'undefined') {
                    word.easeFactor = 2.5;
                    repaired = true;
                }
                if (typeof word.correct === 'undefined') {
                    word.correct = 0;
                    repaired = true;
                }
                if (typeof word.attempts === 'undefined') {
                    word.attempts = 0;
                    repaired = true;
                }
            });
            
            paradigms.forEach(paradigm => {
                if (typeof paradigm.lastReviewed === 'undefined') {
                    paradigm.lastReviewed = 0;
                    repaired = true;
                }
                if (typeof paradigm.interval === 'undefined') {
                    paradigm.interval = 1;
                    repaired = true;
                }
                if (typeof paradigm.easeFactor === 'undefined') {
                    paradigm.easeFactor = 2.5;
                    repaired = true;
                }
                if (typeof paradigm.correct === 'undefined') {
                    paradigm.correct = 0;
                    repaired = true;
                }
                if (typeof paradigm.attempts === 'undefined') {
                    paradigm.attempts = 0;
                    repaired = true;
                }
            });
            
            if (repaired) {
                console.log('🔧 Data repaired and updated');
                saveData();
            }
            
            return repaired;
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 20px;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                z-index: 1000;
                transform: translateX(400px);
                transition: transform 0.3s ease;
            `;
            
            const colors = {
                success: '#4CAF50',
                error: '#f44336',
                warning: '#ff9800',
                info: '#2196F3'
            };
            notification.style.backgroundColor = colors[type] || colors.info;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(400px)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        function setMode(mode) {
            currentMode = mode;
            
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('vocab-mode').classList.toggle('hidden', mode !== 'vocab');
            document.getElementById('paradigm-mode').classList.toggle('hidden', mode !== 'paradigm');
            document.getElementById('paradigm-selector').classList.toggle('hidden', mode !== 'paradigm');
            document.getElementById('input-mode').classList.toggle('hidden', mode !== 'input');
            
            if (mode === 'input') {
                displayVocabList();
            } else if (mode === 'paradigm') {
                nextParadigm();
            } else {
                nextWord();
            }
            
            saveData();
        }

        function setParadigmType(type) {
            selectedParadigmType = type;
            
            document.querySelectorAll('.paradigm-type-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            nextParadigm();
            saveData();
        }

        function nextWord() {
            if (vocabulary.length === 0) return;
            
            const dueWords = getDueWords();
            
            if (dueWords.length > 0) {
                const sortedDue = dueWords.sort((a, b) => a.easeFactor - b.easeFactor);
                currentWordIndex = vocabulary.indexOf(sortedDue[0]);
            } else {
                currentWordIndex = (currentWordIndex + 1) % vocabulary.length;
            }
            
            const word = vocabulary[currentWordIndex];
            
            document.getElementById('greek-word').textContent = word.greek;
            document.getElementById('english-hint').textContent = word.english;
            document.getElementById('english-hint').style.display = 'none';
            document.getElementById('reveal-btn').classList.remove('hidden');
            document.getElementById('know-btn').classList.add('hidden');
            document.getElementById('dont-know-btn').classList.add('hidden');
            document.getElementById('next-btn').classList.add('hidden');
            
            updateStats();
        }

        function getDueWords() {
            const now = Date.now();
            return vocabulary.filter(word => {
                if (word.lastReviewed === 0) {
                    return true;
                }
                const timeSinceReview = now - word.lastReviewed;
                const intervalMs = word.interval * 24 * 60 * 60 * 1000;
                return timeSinceReview >= intervalMs;
            });
        }

        function nextParadigm() {
            let filteredParadigms = paradigms;
            if (selectedParadigmType !== 'all') {
                filteredParadigms = paradigms.filter(p => p.category === selectedParadigmType);
            }
            
            if (filteredParadigms.length === 0) return;
            
            const dueParadigms = getDueParadigms(filteredParadigms);
            
            let selectedParadigm;
            if (dueParadigms.length > 0) {
                const sortedDue = dueParadigms.sort((a, b) => a.easeFactor - b.easeFactor);
                selectedParadigm = sortedDue[0];
            } else {
                const currentFilteredIndex = filteredParadigms.findIndex(p => p.id === paradigms[currentParadigmIndex]?.id);
                const nextFilteredIndex = (currentFilteredIndex + 1) % filteredParadigms.length;
                selectedParadigm = filteredParadigms[nextFilteredIndex];
            }
            
            currentParadigmIndex = paradigms.findIndex(p => p.id === selectedParadigm.id);
            
            document.getElementById('paradigm-word').textContent = selectedParadigm.greek;
            document.getElementById('paradigm-hint').textContent = selectedParadigm.english;
            document.getElementById('paradigm-hint').style.display = 'none';
            
            setupParadigmQuestion(selectedParadigm);
            
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.classList.remove('correct', 'incorrect');
                btn.disabled = false;
            });
        }

        function getDueParadigms(paradigmSet) {
            const now = Date.now();
            return paradigmSet.filter(paradigm => {
                if (paradigm.lastReviewed === 0) {
                    return true;
                }
                const timeSinceReview = now - paradigm.lastReviewed;
                const intervalMs = paradigm.interval * 24 * 60 * 60 * 1000;
                return timeSinceReview >= intervalMs;
            });
        }

        function setupParadigmQuestion(paradigm) {
            const questionEl = document.getElementById('paradigm-question');
            const answersEl = document.getElementById('paradigm-answers');
            
            if (paradigm.category === 'articles') {
                questionEl.textContent = 'Identify Case & Gender';
                answersEl.innerHTML = `
                    <button class="answer-btn" onclick="selectAnswer('nominative masculine')">nom. masc.</button>
                    <button class="answer-btn" onclick="selectAnswer('genitive masculine')">gen. masc.</button>
                    <button class="answer-btn" onclick="selectAnswer('dative masculine')">dat. masc.</button>
                    <button class="answer-btn" onclick="selectAnswer('accusative masculine')">acc. masc.</button>
                    <button class="answer-btn" onclick="selectAnswer('nominative feminine')">nom. fem.</button>
                    <button class="answer-btn" onclick="selectAnswer('accusative feminine')">acc. fem.</button>
                `;
            } else if (paradigm.category === 'to_be_verbs') {
                questionEl.textContent = 'Identify Person & Number';
                answersEl.innerHTML = `
                    <button class="answer-btn" onclick="selectAnswer('1st singular')">I am</button>
                    <button class="answer-btn" onclick="selectAnswer('2nd singular')">you are (sg.)</button>
                    <button class="answer-btn" onclick="selectAnswer('3rd singular')">he/she/it is</button>
                    <button class="answer-btn" onclick="selectAnswer('1st plural')">we are</button>
                    <button class="answer-btn" onclick="selectAnswer('2nd plural')">you are (pl.)</button>
                    <button class="answer-btn" onclick="selectAnswer('3rd plural')">they are</button>
                `;
            } else if (paradigm.category === 'present_active' || paradigm.category === 'present_mediopassive') {
                questionEl.textContent = 'Identify Person & Number';
                answersEl.innerHTML = `
                    <button class="answer-btn" onclick="selectAnswer('1st singular')">1st sing.</button>
                    <button class="answer-btn" onclick="selectAnswer('2nd singular')">2nd sing.</button>
                    <button class="answer-btn" onclick="selectAnswer('3rd singular')">3rd sing.</button>
                    <button class="answer-btn" onclick="selectAnswer('1st plural')">1st plur.</button>
                    <button class="answer-btn" onclick="selectAnswer('2nd plural')">2nd plur.</button>
                    <button class="answer-btn" onclick="selectAnswer('3rd plural')">3rd plur.</button>
                `;
            }
        }

        function selectAnswer(selectedAnswer) {
            const paradigm = paradigms[currentParadigmIndex];
            const buttons = document.querySelectorAll('.answer-btn');
            let correctAnswer = '';
            
            if (paradigm.category === 'articles') {
                correctAnswer = `${paradigm.case} ${paradigm.gender}`;
            } else if (paradigm.category === 'to_be_verbs' || paradigm.category === 'present_active' || paradigm.category === 'present_mediopassive') {
                correctAnswer = `${paradigm.person} ${paradigm.number}`;
            }
            
            document.getElementById('paradigm-hint').style.display = 'block';
            
            buttons.forEach(btn => btn.disabled = true);
            
            buttons.forEach(btn => {
                const buttonAnswer = btn.onclick.toString().match(/'([^']+)'/)[1];
                
                if (buttonAnswer === correctAnswer) {
                    btn.classList.add('correct');
                } else if (buttonAnswer === selectedAnswer && selectedAnswer !== correctAnswer) {
                    btn.classList.add('incorrect');
                }
            });
            
            const isCorrect = selectedAnswer === correctAnswer;
            const category = paradigm.category || 'other_paradigms';
            
            paradigm.attempts++;
            if (isCorrect) {
                paradigm.correct++;
                sessionStats.correct++;
                categoryStats[category].correct++;
            } else {
                sessionStats.incorrect++;
            }
            sessionStats.total++;
            categoryStats[category].total++;
            
            updateSpacedRepetition(paradigm, isCorrect ? 4 : 1);
            
            updateStats();
            updatePerformanceDashboard();
            saveData();
        }

        function updateSpacedRepetition(word, quality) {
            const now = Date.now();
            word.lastReviewed = now;
            
            if (quality >= 3) {
                if (word.interval === 1) {
                    word.interval = 6;
                } else {
                    word.interval = Math.round(word.interval * word.easeFactor);
                }
                word.easeFactor = word.easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
            } else {
                word.interval = 1;
                word.easeFactor = Math.max(1.3, word.easeFactor - 0.2);
            }
            
            word.easeFactor = Math.max(1.3, Math.min(2.5, word.easeFactor));
        }

        function revealAnswer() {
            document.getElementById('english-hint').style.display = 'block';
            document.getElementById('reveal-btn').classList.add('hidden');
            document.getElementById('know-btn').classList.remove('hidden');
            document.getElementById('dont-know-btn').classList.remove('hidden');
        }

        function markCorrect() {
            if (vocabulary.length === 0) return;
            
            const word = vocabulary[currentWordIndex];
            word.correct++;
            word.attempts++;
            updateSpacedRepetition(word, 4);
            
            sessionStats.correct++;
            sessionStats.total++;
            categoryStats.vocabulary.correct++;
            categoryStats.vocabulary.total++;
            
            document.getElementById('know-btn').classList.add('hidden');
            document.getElementById('dont-know-btn').classList.add('hidden');
            document.getElementById('next-btn').classList.remove('hidden');
            
            saveData();
        }

        function markIncorrect() {
            if (vocabulary.length === 0) return;
            
            const word = vocabulary[currentWordIndex];
            word.attempts++;
            updateSpacedRepetition(word, 1);
            
            sessionStats.incorrect++;
            sessionStats.total++;
            categoryStats.vocabulary.total++;
            
            document.getElementById('know-btn').classList.add('hidden');
            document.getElementById('dont-know-btn').classList.add('hidden');
            document.getElementById('next-btn').classList.remove('hidden');
            
            saveData();
        }

        function speakGreek() {
            const text = currentMode === 'vocab' 
                ? document.getElementById('greek-word').textContent
                : document.getElementById('paradigm-word').textContent;
            
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = 0.7;
                utterance.pitch = 0.9;
                speechSynthesis.speak(utterance);
            }
        }

        function addVocab() {
            const greek = document.getElementById('greek-input').value.trim();
            const english = document.getElementById('english-input').value.trim();
            const type = document.getElementById('type-input').value;
            const declension = document.getElementById('declension-input').value;
            
            if (greek && english) {
                const newWord = {
                    id: Date.now(),
                    greek: greek,
                    english: english,
                    type: type,
                    declension: type === 'noun' ? declension : undefined,
                    correct: 0,
                    attempts: 0,
                    lastReviewed: 0,
                    interval: 1,
                    easeFactor: 2.5
                };
                
                vocabulary.push(newWord);
                saveData();
                displayVocabList();
                
                document.getElementById('greek-input').value = '';
                document.getElementById('english-input').value = '';
            }
        }

        function deleteVocab(id) {
            vocabulary = vocabulary.filter(word => word.id !== id);
            saveData();
            displayVocabList();
        }

        function displayVocabList() {
            const list = document.getElementById('vocab-list');
            list.innerHTML = vocabulary.map(word => 
                `<div class="vocab-item">
                    <span><strong>${word.greek}</strong> - ${word.english} (${word.type}${word.declension ? ', ' + word.declension + ' decl.' : ''})</span>
                    <button class="delete-btn" onclick="deleteVocab(${word.id})">Delete</button>
                </div>`
            ).join('');
        }

        function smartDetectWordType() {
            // Simple implementation
        }

        function importVocab() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.csv';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const csv = e.target.result;
                        const lines = csv.split('\n');
                        lines.forEach(line => {
                            const [greek, english, type] = line.split(',');
                            if (greek && english) {
                                vocabulary.push({
                                    id: Date.now() + Math.random(),
                                    greek: greek.trim(),
                                    english: english.trim(),
                                    type: (type || 'noun').trim(),
                                    correct: 0,
                                    attempts: 0,
                                    lastReviewed: 0,
                                    interval: 1,
                                    easeFactor: 2.5
                                });
                            }
                        });
                        saveData();
                        displayVocabList();
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function uploadLessonDocument() {
            alert('Feature coming soon! For now, use the Add Words form or Import CSV.');
        }

        function updatePerformanceDashboard() {
            const totalAttempted = sessionStats.total;
            const accuracyRate = totalAttempted > 0 ? Math.round((sessionStats.correct / totalAttempted) * 100) : 0;
            const wordsDue = getDueWords().length + getDueParadigms(paradigms).length;
            
            document.getElementById('total-attempted').textContent = totalAttempted;
            document.getElementById('accuracy-rate').textContent = accuracyRate + '%';
            document.getElementById('words-due').textContent = wordsDue;
            
            const categoryStatsEl = document.getElementById('category-stats');
            let categoryHtml = '';
            
            for (const [key, name] of Object.entries({
                'articles': 'Articles',
                'to_be_verbs': 'To Be Verbs',
                'pronouns': 'Pronouns',
                'present_active': 'Present Active',
                'present_mediopassive': 'Present M/P',
                'deponent_verbs': 'Deponent Verbs',
                'vocabulary': 'Vocabulary'
            })) {
                const stats = categoryStats[key];
                if (stats.total > 0) {
                    const percentage = Math.round((stats.correct / stats.total) * 100);
                    categoryHtml += `
                        <div class="category-stat">
                            <span>${name}</span>
                            <span>${percentage}% (${stats.correct}/${stats.total})</span>
                        </div>
                    `;
                }
            }
            categoryStatsEl.innerHTML = categoryHtml;
            
            updateRecentMistakes();
        }

        function updateRecentMistakes() {
            const mistakeList = document.getElementById('mistake-list');
            const recentMistakes = [];
            
            vocabulary.forEach(word => {
                if (word.attempts > 0 && word.correct / word.attempts < 0.7) {
                    recentMistakes.push({
                        greek: word.greek,
                        english: word.english,
                        type: 'vocabulary',
                        accuracy: Math.round((word.correct / word.attempts) * 100)
                    });
                }
            });
            
            paradigms.forEach(paradigm => {
                if (paradigm.attempts > 0 && paradigm.correct / paradigm.attempts < 0.7) {
                    recentMistakes.push({
                        greek: paradigm.greek,
                        english: paradigm.english,
                        type: paradigm.category,
                        accuracy: Math.round((paradigm.correct / paradigm.attempts) * 100)
                    });
                }
            });
            
            recentMistakes.sort((a, b) => a.accuracy - b.accuracy);
            
            if (recentMistakes.length > 0) {
                mistakeList.innerHTML = recentMistakes.slice(0, 5).map(mistake => 
                    `<div class="mistake-item">
                        <span class="mistake-word">${mistake.greek}</span> - ${mistake.english} 
                        <small>(${mistake.type}, ${mistake.accuracy}% accuracy)</small>
                    </div>`
                ).join('');
            } else {
                mistakeList.innerHTML = '<div style="color: #4caf50; font-style: italic;">No problem areas identified yet!</div>';
            }
        }

        function updateStats() {
            document.getElementById('remaining-count').textContent = vocabulary.length;
            document.getElementById('correct-score').textContent = sessionStats.correct;
            document.getElementById('incorrect-score').textContent = sessionStats.incorrect;
            
            const percentage = sessionStats.total > 0 
                ? Math.round((sessionStats.correct / sessionStats.total) * 100)
                : 0;
            document.getElementById('comprehension-percentage').textContent = percentage + '%';
        }

        function updateDisplay() {
            if (currentMode === 'vocab') {
                nextWord();
            } else if (currentMode === 'paradigm') {
                nextParadigm();
            }
        }

        function checkForRecommendations() {
            // Show recommendations after every 10 questions
            if (sessionStats.total > 0 && sessionStats.total % 10 === 0) {
                showRecommendations();
            }
        }

        function showRecommendations() {
            // Implementation for recommendations
        }

        function hideRecommendations() {
            document.getElementById('study-recommendations').classList.add('hidden');
        }

        function saveDataManually() {
            updateSaveStatus('saving', 'Saving...');
            
            setTimeout(() => {
                saveData();
                refreshStorageInfo();
                
                setTimeout(() => {
                    updateSaveStatus('auto', 'Auto-save enabled');
                }, 2000);
            }, 500);
        }

        function exportProgress() {
            const exportData = {
                vocabulary: vocabulary,
                paradigms: paradigms,
                sessionStats: sessionStats,
                categoryStats: categoryStats,
                appState: appState,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `greek-nt-progress-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('Progress exported successfully!', 'success');
        }

        function importProgress() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const importData = JSON.parse(e.target.result);
                            
                            if (importData.vocabulary && importData.paradigms) {
                                vocabulary = importData.vocabulary;
                                paradigms = importData.paradigms;
                                sessionStats = importData.sessionStats || sessionStats;
                                categoryStats = importData.categoryStats || categoryStats;
                                appState = {...appState, ...(importData.appState || {})};
                                
                                validateAndRepairData();
                                saveData();
                                
                                updateDisplay();
                                updateStats();
                                updatePerformanceDashboard();
                                refreshStorageInfo();
                                
                                showNotification('Progress imported successfully!', 'success');
                            } else {
                                throw new Error('Invalid file format');
                            }
                        } catch (error) {
                            console.error('Import error:', error);
                            showNotification('Error importing file. Please check the format.', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function getStorageInfo() {
            let totalSize = 0;
            let itemCount = 0;
            
            for (let key in localStorage) {
                if (key.startsWith('greek')) {
                    const item = localStorage.getItem(key);
                    totalSize += item ? item.length : 0;
                    itemCount++;
                }
            }
            
            return {
                totalSize: totalSize,
                itemCount: itemCount,
                vocabulary: vocabulary.length,
                paradigms: paradigms.length,
                totalStudied: sessionStats.total,
                lastSaved: localStorage.getItem('greekLastSaved') ? 
                    new Date(parseInt(localStorage.getItem('greekLastSaved'))).toLocaleString() : 'Never'
            };
        }

        function refreshStorageInfo() {
            const info = getStorageInfo();
            
            const vocabCountEl = document.getElementById('vocab-count');
            const paradigmCountEl = document.getElementById('paradigm-count');
            const totalQuestionsEl = document.getElementById('total-questions');
            const lastSavedEl = document.getElementById('last-saved');
            const dataSizeEl = document.getElementById('data-size');
            
            if (vocabCountEl) vocabCountEl.textContent = info.vocabulary;
            if (paradigmCountEl) paradigmCountEl.textContent = info.paradigms;
            if (totalQuestionsEl) totalQuestionsEl.textContent = info.totalStudied;
            if (lastSavedEl) lastSavedEl.textContent = info.lastSaved;
            if (dataSizeEl) dataSizeEl.textContent = `${(info.totalSize / 1024).toFixed(1)} KB`;
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear ALL progress? This cannot be undone!')) {
                const keysToRemove = [];
                for (let key in localStorage) {
                    if (key.startsWith('greek')) {
                        keysToRemove.push(key);
                    }
                }
                
                keysToRemove.forEach(key => localStorage.removeItem(key));
                location.reload();
            }
        }

        function updateSaveStatus(type, message) {
            const statusDot = document.querySelector('.status-dot');
            const statusText = document.getElementById('save-status-text');
            
            if (statusDot && statusText) {
                statusDot.className = 'status-dot';
                
                switch(type) {
                    case 'saving':
                        statusDot.classList.add('saving');
                        break;
                    case 'error':
                        statusDot.classList.add('error');
                        break;
                    case 'success':
                        break;
                    case 'auto':
                        break;
                }
                
                statusText.textContent = message;
                
                if (type === 'success') {
                    setTimeout(() => {
                        updateSaveStatus('auto', 'Auto-save enabled');
                    }, 2000);
                }
            }
        }

        function restoreUIState() {
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            const modeBtn = document.querySelector(`[onclick*="${currentMode}"]`);
            if (modeBtn) modeBtn.classList.add('active');
            
            if (currentMode === 'paradigm') {
                document.querySelectorAll('.paradigm-type-btn').forEach(btn => btn.classList.remove('active'));
                const paradigmBtn = document.querySelector(`[onclick*="${selectedParadigmType}"]`);
                if (paradigmBtn) paradigmBtn.classList.add('active');
            }
            
            document.getElementById('vocab-mode').classList.toggle('hidden', currentMode !== 'vocab');
            document.getElementById('paradigm-mode').classList.toggle('hidden', currentMode !== 'paradigm');
            document.getElementById('paradigm-selector').classList.toggle('hidden', currentMode !== 'paradigm');
            document.getElementById('input-mode').classList.toggle('hidden', currentMode !== 'input');
        }

        function init() {
            console.log('🚀 Initializing Greek NT Learning App...');
            
            loadData();
            validateAndRepairData();
            startAutoSave();
            restoreUIState();
            updateDisplay();
            updateStats();
            updatePerformanceDashboard();
            refreshStorageInfo();
            
            console.log('✅ App initialized successfully');
        }

        window.onload = function() {
            init();
        };
    </script>
</body>
</html>
